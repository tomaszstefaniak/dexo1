"use strict";(self.webpackChunk_jup_ag_terminal=self.webpackChunk_jup_ag_terminal||[]).push([[654],{57654:(e,t,r)=>{r.r(t),r.d(t,{Errors:()=>T,JUPITER_FEE_OWNER:()=>o.Nq,JUPITER_PROGRAM_V4_ID:()=>o.Ki,JUPITER_PROGRAM_V6_ID:()=>o.qf,JUPITER_V6_ERRORS:()=>o.XS,JupiterProvider:()=>I,LAMPORTS_PER_SIGNATURE:()=>o.cm,MARKETS_URL:()=>o.uW,OPENBOOK_PROGRAM_ID:()=>o.$Z,Owner:()=>o._e,SwapMode:()=>o.zP,TOKEN_LIST_URL:()=>o.bB,calculateFeeForSwap:()=>N,useJupiter:()=>h,useJupiterClient:()=>S,useJupiterExchange:()=>M});var n=r(66789),o=r(96706),a=r(52947),i=r(11162),s=r(62643),u=r(75951),c=r(71369),l=r(96540),p=r(17924),d=r(96763),f=r(48287).Buffer,T={INITIALIZE_ERROR:"INITIALIZE_ERROR",FETCH_ROUTES_ERROR:"FETCH_ROUTES_ERROR",NO_ROUTES_ERROR:"NO_ROUTES_ERROR",TOKEN_NOT_TRADABLE:"TOKEN_NOT_TRADABLE",COULD_NOT_FIND_ANY_ROUTE:"COULD_NOT_FIND_ANY_ROUTE",INVALID_REQUEST:"INVALID_REQUEST",ROUTE_PLAN_DOES_NOT_CONSUME_ALL_THE_AMOUNT:"ROUTE_PLAN_DOES_NOT_CONSUME_ALL_THE_AMOUNT"},E=(0,p.au)((0,p.KJ)(s.PublicKey),(0,p.Yj)(),(e=>new s.PublicKey(e))),w=(0,p.au)((0,p.KJ)(u),(0,p.Yj)(),(e=>u.BigInt(e))),g=(0,p.au)((0,p.Yj)(),(0,p.ai)(),(e=>new Number(e))),m=(0,p.NW)({ammKey:E,label:(0,p.Yj)(),inputMint:(0,p.Yj)(),outputMint:(0,p.Yj)(),inAmount:w,outAmount:w,feeAmount:w,feeMint:E}),R=(0,p.NW)({swapInfo:m,percent:(0,p.nd)()}),O=(0,p.YO)(R),A=(0,p.NW)({inputMint:E,inAmount:w,outputMint:E,outAmount:w,otherAmountThreshold:w,priceImpactPct:g,swapMode:(0,p.vP)(["ExactIn","ExactOut"]),routePlan:O,slippageBps:(0,p.ai)(),contextSlot:(0,p.ai)(),computedAutoSlippage:(0,p.lq)((0,p.ai)())}),_=(0,l.createContext)(null),I=({onlyDirectRoutes:e,userPublicKey:t,jupiterQuoteApiUrl:r,children:a,...i})=>{const[u,c]=(0,l.useState)(new Map),[p,d]=(0,l.useState)(),[f,T]=(0,l.useState)(new Set),E=(0,l.useRef)();(0,l.useEffect)((()=>{E.current=i.platformFeeAndAccounts}),[i.platformFeeAndAccounts]);const w=(0,l.useCallback)(((e,t)=>{E.current&&(E.current.feeAccounts||(E.current.feeAccounts=new Map),E.current.feeAccounts.set(e,t))}),[]),g=(0,l.useCallback)((async e=>{var t;const r=E.current,n=null==(t=null==r?void 0:r.feeAccounts)?void 0:t.get(e),a=null==r?void 0:r.feeBps;if(n)return n;if(null!==n&&a&&(null==r?void 0:r.referralAccount)){const t=await(0,o.oy)({connection:i.connection,referralAccount:r.referralAccount,mint:new s.PublicKey(e)});if(w(e,t),t)return t}}),[]),m=(0,l.useMemo)((()=>r?(0,n.Zu)({basePath:r}):(0,n.Zu)()),[r]);return(0,l.useEffect)((()=>{T((e=>e.size?new Set:e))}),[i.asLegacyTransaction]),(0,l.useEffect)((()=>{!async function(){const e=await m.programIdToLabelGet(),t=new Map(Object.entries(e));c(t)}()}),[m]),l.createElement(_.Provider,{value:{...i,getPlatformFeeAccount:g,userPublicKey:t,programIdToLabelMap:u,jupiterApiClient:m,error:p,setError:d,onlyDirectRoutes:e,programIdsExcluded:f,setProgramIdsExcluded:T,whitelistedFeeMints:i.whitelistedFeeMints}},a)},S=()=>{const e=(0,l.useContext)(_);if(!e)throw new Error("JupiterProvider is required");return e.jupiterApiClient},h=({amount:e,inputMint:t,outputMint:r,autoSlippage:n,maxAutoSlippageBps:a,autoSlippageCollisionUsdValue:i,slippageBps:s,swapMode:f,debounceTime:E=250,maxAccounts:w,disabledProgramIds:g,computeAutoSlippage:m,minimizeSlippage:R,preferLiquidDexes:O})=>{const I=(0,l.useContext)(_),[S,h]=(0,l.useState)(!1),[N,P]=(0,l.useState)(),[y,B]=(0,l.useState)(0),b=(0,l.useRef)(y),[L,U,q,v]=function(e,t){const[r,n]=(0,l.useState)(e);return(0,l.useEffect)((()=>{const r=setTimeout((()=>{n(e)}),t);return()=>{clearTimeout(r)}}),[e,t]),r}(l.useMemo((()=>(u.greaterThan(e,u.BigInt(0))&&h(!0),[e,t,r,f])),[e.toString(),null==t?void 0:t.toBase58(),null==r?void 0:r.toBase58(),f]),E),C=(0,l.useRef)(0),x=(0,l.useRef)(0);if(!I)throw new Error("JupiterProvider is required");const{error:k,setError:D,routeCacheDuration:K=0,onlyDirectRoutes:j,jupiterApiClient:F,userPublicKey:V,wrapUnwrapSOL:z=!0,asLegacyTransaction:J,platformFeeAndAccounts:H,programIdToLabelMap:G,setProgramIdsExcluded:W,programIdsExcluded:Y,whitelistedFeeMints:Z}=I;(0,l.useEffect)((()=>{b.current=-1}),[[null==U?void 0:U.toString(),null==q?void 0:q.toString()].sort().join("-"),n,a,i,s]),(0,l.useEffect)((()=>{C.current&&(new Date).getTime()-C.current>=K&&(b.current=-1),u.greaterThan(L,u.BigInt(0))?h(!0):h(!1)}),[y,L,s,U,q,j,J]);const Q=(0,l.useCallback)((async()=>{try{if(u.equal(L,u.BigInt(0))||k===T.INITIALIZE_ERROR)return null;if(L){if(!U||!q)return null;if(s&&n)throw new Error("Cannot set both slippageBps and autoSlippage");if(!n&&a)throw new Error("Cannot set maxAutoSlippageBps without autoSlippage");const e=U.toBase58(),t=q.toBase58();let r,u;f===o.zP.ExactOut&&w&&d.warn("maxAccounts is not supported for ExactOut swap mode");const l=Array.from([...Y,...g||[]]).map((e=>G.get(e))).filter((e=>Boolean(e))),T=function(){const e={},t=localStorage.getItem("quoteParams");if(t){const r=JSON.parse(t);Object.assign(e,r)}const r=localStorage.getItem("quoteArgs");if(r){const t=JSON.parse(r);for(const[r,n]of Object.entries(t))e[`quoteArg-${r}`]=n}return e}(),E=new Proxy(F,{get:function(e,t){return"request"===t?(t,r)=>(Object.keys(T).length&&(d.log("Quoting with overrides:",T),Object.assign(t.query,T)),e.request(t,r)):Reflect.get(e,t)}}),_=(f===o.zP.ExactOut?[e]:[e,t]).filter((e=>!Z||(null==Z?void 0:Z.includes(e)))).length>0?null==H?void 0:H.feeBps:void 0,I=await c((r=>E.quoteGet({inputMint:e,outputMint:t,amount:L.toString(),autoSlippage:n,maxAutoSlippageBps:a,autoSlippageCollisionUsdValue:i,slippageBps:s,swapMode:f,excludeDexes:l.length?[l.filter(Boolean).join(",")]:void 0,onlyDirectRoutes:j,asLegacyTransaction:J,platformFeeBps:_,maxAccounts:w,computeAutoSlippage:m,minimizeSlippage:R,preferLiquidDexes:O}).catch((e=>{r(e)}))),{retries:1,minTimeout:100});return u=Object.assign({},I),r=(0,p.vt)(I,A),{quoteResponse:r,original:u,timestamp:(new Date).getTime()}}return null}catch(e){throw e}}),[L,U,q,v,s,a,f,w,V,z,y,j,J,Y,O]);(0,l.useEffect)((()=>{let e=!1;return(async()=>{if(u.equal(L,u.BigInt(0))||k===T.INITIALIZE_ERROR)h(!1),P(void 0);else if(L){if(!U||!q)return;const t=(new Date).getTime();x.current=t,C.current=t;try{const t=await Q();if(!(null==t?void 0:t.quoteResponse)||!(null==t?void 0:t.original)||!(null==t?void 0:t.timestamp)||e)return;P({quoteResponse:t.quoteResponse,original:t.original}),D(void 0)}catch(e){if(d.error(e),x.current!==t)return;const r=await(async()=>{try{if("response"in e&&e.response instanceof Response)return(await e.response.json()).errorCode||null}catch(e){return d.log("Error parsing error response",e),null}})();D(r||T.FETCH_ROUTES_ERROR),P(void 0)}finally{if(x.current!==t)return;b.current=y,h(!1)}}})(),()=>{e=!0}}),[Q]);const{exchange:$,fetchSwapTransaction:X}=M(f);return{exchange:$,fetchQuote:Q,fetchSwapTransaction:X,refresh:l.useCallback((()=>{!S&&C.current&&B((e=>e+1))}),[S]),lastRefreshTimestamp:C.current,loading:S,quoteResponseMeta:N,error:k,programIdToLabelMap:G,setProgramIdsExcluded:W,programIdsExcluded:Y}},M=e=>{const t=(0,l.useContext)(_);if(!t)throw new Error("JupiterProvider is required");const{jupiterApiClient:r,userPublicKey:n,connection:u,wrapUnwrapSOL:p=!0,asLegacyTransaction:d,platformFeeAndAccounts:T,useSharedAccounts:E,getPlatformFeeAccount:w,whitelistedFeeMints:g}=t,m=(0,l.useCallback)((async({quoteResponseMeta:t,userPublicKey:n,wrapUnwrapSOL:i,prioritizationFeeLamports:u,allowOptimizedWrappedSolTokenAccount:l,dynamicSlippage:T})=>{if(!n)throw new Error("User public key is required");const m=Boolean(i??p??!0),{inputMint:R,outputMint:O}=t.quoteResponse,A=(e===o.zP.ExactOut?[R]:[R,O]).filter((e=>!g||(null==g?void 0:g.includes(e.toString())))),_=0!==A.length?await(async()=>{for(const e of A){const t=await w(e.toBase58());if(t)return t}})():void 0,I=await c((e=>r.swapPost({swapRequest:{quoteResponse:t.original,userPublicKey:n.toBase58(),wrapAndUnwrapSol:m,feeAccount:null==_?void 0:_.toBase58(),asLegacyTransaction:d,useSharedAccounts:E,dynamicComputeUnitLimit:!0,allowOptimizedWrappedSolTokenAccount:l,prioritizationFeeLamports:u,dynamicSlippage:T,correctLastValidBlockHeight:!0}}).catch((async t=>{try{const{error:e}=await t.json();return{error:new a.TransactionError(e)}}catch(t){return e({error:new a.TransactionError("Unknown error")})}}))),{retries:1,minTimeout:100});if("error"in I)return I;const{swapTransaction:S,lastValidBlockHeight:h}=I,M=f.from(S,"base64"),N=d?s.Transaction.from(M):s.VersionedTransaction.deserialize(M);return(0,a.checkTxSize)(N),{swapTransaction:N,blockhash:(0,o.y9)(N),lastValidBlockHeight:h,dynamicSlippageReport:I.dynamicSlippageReport}}),[p,d,E,w,r]);return{exchange:(0,l.useCallback)((async({wallet:e,quoteResponseMeta:t,onTransaction:r,prioritizationFeeLamports:a,...c})=>{if(!n)throw new Error("User public key is required");if(!e)throw new Error("Wallet is required");const{inputMint:l,outputMint:d}=t.quoteResponse,f=Boolean(c.wrapUnwrapSOL??p??!0),[T,E]=await Promise.all([m({quoteResponseMeta:t,userPublicKey:n,wrapUnwrapSOL:f,prioritizationFeeLamports:a,...c}),u.getMultipleAccountsInfo([l,d])]);if("error"in T)return T;const{blockhash:w,lastValidBlockHeight:g,swapTransaction:R}=T,[O,A]=[l,d].map(((e,t)=>{var r;return function(e,t,r=i.TOKEN_PROGRAM_ID){const[n]=s.PublicKey.findProgramAddressSync([t.toBuffer(),r.toBuffer(),e.toBuffer()],i.ASSOCIATED_TOKEN_PROGRAM_ID);return n}(e,n,(null==(r=E[t])?void 0:r.owner)||i.TOKEN_PROGRAM_ID)}));return(0,o.Mp)({connection:u,wallet:e,onTransaction:r,inputMint:l,outputMint:d,sourceAddress:O,destinationAddress:A,swapTransaction:R,blockhashWithBlockHeight:{lastValidBlockHeight:g,blockhash:w},owner:new o._e(n),wrapUnwrapSOL:f})}),[n,p,d,u,T,r,e]),fetchSwapTransaction:m}},N=(e,t,r,n,a)=>{const s=new Set,u=new Set,c=Boolean(n&&(null==e?void 0:e.inputMint.equals(i.NATIVE_MINT)));if(e){if(a){let r=0;return(e.inputMint.equals(i.NATIVE_MINT)||e.outputMint.equals(i.NATIVE_MINT)&&n&&!t.has(i.NATIVE_MINT.toBase58()))&&(r=1),(0,o.On)({numOfAtasToBeCreated:r,numOfOpenOrdersToBeCreated:0,isInputMintSOL:c})}e.inputMint.equals(i.NATIVE_MINT)&&n&&!t.has(i.NATIVE_MINT.toBase58())&&s.add(i.NATIVE_MINT.toBase58()),l=e.routePlan,a||l.forEach((e=>{t.has(e.swapInfo.outputMint)||s.add(e.swapInfo.outputMint),"Openbook"===e.swapInfo.label&&(r.has(e.swapInfo.ammKey.toBase58())||u.add(e.swapInfo.outputMint))}))}var l;return(0,o.On)({numOfAtasToBeCreated:s.size,numOfOpenOrdersToBeCreated:u.size,isInputMintSOL:c})}}}]);
//# sourceMappingURL=main-4.0.1-654.js.map