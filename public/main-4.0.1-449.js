"use strict";(self.webpackChunk_jup_ag_terminal=self.webpackChunk_jup_ag_terminal||[]).push([[449],{41811:(t,e,r)=>{r.d(e,{A:()=>a});var o=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function n(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!((n=t[r])===(a=e[r])||o(n)&&o(a)))return!1;var n,a;return!0}const a=function(t,e){var r;void 0===e&&(e=n);var o,a=[],i=!1;return function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];return i&&r===this&&e(n,a)||(o=t.apply(this,n),i=!0,r=this,a=n),o}}},52947:(t,e,r)=>{r.r(e),r.d(e,{COMMON_TX_ERRORS:()=>f,TOKEN_2022_PROGRAM_ID:()=>W,TransactionError:()=>p,checkTxSize:()=>M,createAndTransferWSOLTransaction:()=>F,createJitoTipTx:()=>_,createUnwrapSolTransaction:()=>v,deserializeAccount:()=>B,deserializeMint:()=>K,estimatePriorityFee:()=>x,extractComputeUnitLimit:()=>E,extractComputeUnitPrice:()=>b,fetchMintInfos:()=>G,fetchTokenMetadatas:()=>H,findMetadataAddress:()=>q,forwardToJito:()=>I,getATA:()=>L,getMultipleAccountsInfo:()=>Z,getOrCreateATAInstruction:()=>z,getRandomTipAccount:()=>w,getSignature:()=>O,handleSendTransaction:()=>P,modifyComputeUnitLimitIx:()=>S,modifyComputeUnitPriceIx:()=>k,parseErrorForTransaction:()=>T,parseErrorWithIdl:()=>C,removeEmptyChars:()=>V,transactionSenderAndConfirmationWaiter:()=>N});var o=r(11162),n=r(46400),a=r(62643),i=r(71369),s=r.n(i),c=r(33336),u=r(92466),d=r(51597),l=r(66822),m=r(96763),g=r(48287).Buffer;class p extends Error{constructor(t,e,r,o,n){super(t),this.txid=void 0,this.code=void 0,this.programIds=void 0,this.serializedTx=void 0,this.txid=e,this.code=r,this.programIds=o,this.serializedTx=n,Object.setPrototypeOf(this,Error.prototype)}}const f={PROGRAM_FAILED_TO_COMPLETE_ERROR:"Program failed to complete",UNKNOWN_ERROR:"Unknown error, visit the explorer",TOO_MANY_ACCOUNT_LOCKS:"Transaction locked too many accounts",INSUFFICIENT_FUNDS_FOR_RENT:"The account does not have enough SOL to perform the operation",TRANSACTION_TOO_LARGE:"Transaction too large",TRANSACTION_NOT_CONFIRMED:"Transaction has expired and was not confirmed. Please try again.",FROZEN_ACCOUNT:"The token account is frozen",TRANSACTION_EXPIRED_BLOCKHEIGHT_EXCEEDED:"TransactionExpiredBlockheightExceededError"},h="11111111111111111111111111111111";function T({err:t,logMessages:e}){const r=t;let n;if(r&&"string"!=typeof r){if("InsufficientFundsForRent"in r)return{message:f.INSUFFICIENT_FUNDS_FOR_RENT,code:1,programIds:[o.TOKEN_PROGRAM_ID.toBase58()]};{const t=r.InstructionError,[a,i]=t;if("string"==typeof i){if("ProgramFailedToComplete"===i&&e){const t=function(t){let e=[];for(let r=0;r<t.length;r++){const o=t[r].match(new RegExp(/Program (\S+) failed: (?:Program failed to complete|SBF program panicked)/));o&&e.push(o[1])}return e}(e);if(t.length>0)return{message:f.PROGRAM_FAILED_TO_COMPLETE_ERROR,programIds:t,code:n}}}else if(n=i.Custom??t[1],e){const r=function(t,e){for(let r=0;r<t.length;r++){const o=t[r].match(new RegExp(`Program ([1-9A-HJ-NP-Za-km-z]{32,44}) failed: custom program error: 0x${e.toString(16)}`));if(o)return o[1]}}(e,n);if(r)return r===h?function(t){const e=t[1].Custom;let r="";switch(e){case 0:r="An account with the same address already exists";break;case 1:r=f.INSUFFICIENT_FUNDS_FOR_RENT;break;default:r=f.UNKNOWN_ERROR}return{code:e,programIds:[h],message:r}}(t):r===o.TOKEN_PROGRAM_ID.toBase58()&&17===n?{message:f.FROZEN_ACCOUNT,programIds:[r],code:n}:{message:f.UNKNOWN_ERROR,programIds:[r],code:n}}}}return"InsufficientFundsForFee"===r?{message:f.INSUFFICIENT_FUNDS_FOR_RENT,code:1,programIds:[o.TOKEN_PROGRAM_ID.toBase58()]}:"TooManyAccountLocks"===r?{message:f.TOO_MANY_ACCOUNT_LOCKS,code:0,programIds:[]}:{message:"string"==typeof r&&r||f.UNKNOWN_ERROR,code:n}}const y=t=>new Promise((e=>setTimeout(e,t))),A={maxRetries:0,skipPreflight:!0};async function I(t,e,r){try{const o=await fetch(r??"https://mainnet.block-engine.jito.wtf/api/v1/bundles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"sendBundle",params:[[n.bs58.encode(t),n.bs58.encode(e.serialize())]]})}),a=await o.json();if(a.result)return m.log("Sent to JITO",a.result),a}catch(t){m.log("Failed to send to Jito",t)}return null}async function N({txid:t,connection:e,serializedTransaction:r,blockhashWithBlockHeight:o,broadcastMode:n,jitoTipTx:i,jitoProxyUrl:c}){const u=new AbortController,d=u.signal;let l=null;try{"jito"===n&&i?l=await I(r,i,c):("mixed"===n&&i&&(l=await I(r,i,c)),await e.sendRawTransaction(r,A),(async()=>{for(;;){if(await y(1750),d.aborted)return;try{await e.sendRawTransaction(r,A)}catch(t){m.warn(`Failed to resend transaction: ${t}`)}}})()),await Promise.race([e.confirmTransaction({...o,signature:t,abortSignal:d},"confirmed"),new Promise((async r=>{for(;!d.aborted;){await y(2e3);const o=await e.getSignatureStatus(t,{searchTransactionHistory:!1});"confirmed"===o?.value?.confirmationStatus&&r(o)}}))])}catch(t){if(t instanceof a.TransactionExpiredBlockheightExceededError)return{response:null,jitoResponse:l};throw t}finally{u.abort()}return{response:await s()((async r=>{const o=await e.getTransaction(t,{commitment:"confirmed",maxSupportedTransactionVersion:0});return o||r(o),o}),{retries:5,minTimeout:1e3}),jitoResponse:l}}function O(t){const e="signature"in t?t.signature:t.signatures[0];if(!e)throw new Error("Missing transaction signature, the transaction was not signed by the fee payer");return c.Wp.bytes.bs58.encode(e)}const P=async({connection:t,signedTransaction:e,blockhash:r,lastValidBlockHeight:o,idl:n,skipPreflight:i,idlProgramId:s,minContextSlot:c,broadcastMode:u,jitoTipTx:d,jitoProxyUrl:l,debug:h})=>{let T=g.from(e.serialize()),y=O(e);const{value:A}=await t.simulateTransaction("message"in e?e:new a.VersionedTransaction(e.compileMessage()),{replaceRecentBlockhash:!0,commitment:"processed",minContextSlot:c}),{err:I,logs:P}=A;if(h&&m.log("Simulated Transaction Logs:",P),I){const t=C({err:I,logMessages:P},void 0,n,s);if(!i)return t.serializedTx=g.from(e.serialize()).toString("base64"),{error:t,txid:void 0};if(t.message===f.INSUFFICIENT_FUNDS_FOR_RENT||t.message===f.TOO_MANY_ACCOUNT_LOCKS)return t.serializedTx=g.from(e.serialize()).toString("base64"),{error:t,txid:void 0}}const{response:R,jitoResponse:w}=await N({txid:y,connection:t,serializedTransaction:T,blockhashWithBlockHeight:{blockhash:r,lastValidBlockHeight:o},broadcastMode:u,jitoTipTx:d,jitoProxyUrl:l});if(!R){const t=new p(f.TRANSACTION_NOT_CONFIRMED);return t.serializedTx=g.from(e.serialize()).toString("base64"),{error:t,txid:void 0}}if(R.meta?.err){const t=C(R.meta,y,n,s);return t.serializedTx=g.from(e.serialize()).toString("base64"),{error:t,transactionResponse:R,txid:y}}return{transactionResponse:R,jitoResponse:w,txid:y}},C=(t,e,r,o)=>{const{code:n,programIds:a,message:i}=T(t);if(o&&r&&a?.includes(o.toBase58())){let t=r.errors?.find((t=>t.code===n));if(t)return new p(t.msg??t.name,e,t.code,a)}return new p(i,e,n,a)},R=["96gYZGLnJYVFmbjzopPSU6QiEV5fGqZNyN9nmNhvrZU5","HFqU5x63VTqvQss8hp11i4wVV8bD44PvwucfZ2bU7gRe","Cw8CFyM9FkoMi7K7Crf6HNQqf4uEMzpKw6QNghXLvLkY","ADaUMid9yfUytqMBgopwjb2DTLSokTSzL1zt6iGPaS49","DfXygSm4jCyNCybVYYK6DwvWqjKee8pbDmJGcLWNDXjh","ADuUkR4vqLUMWXxW9gh6D6L8pMSawimctcNZ5pGwDcEt","DttWaMuVvTiduZRnguLF7jNxTgiMBZ1hyAumKUiL2KRL","3AVi9Tg9Uo68tJfuvoKvqKNWKkC5wPdSSdeBnizKZ6jT"],w=()=>new a.PublicKey(R[Math.floor(Math.random()*R.length)]);function _({payer:t,lamports:e,blockhash:r,lastValidBlockHeight:o}){const n=w(),i=a.SystemProgram.transfer({fromPubkey:t,toPubkey:n,lamports:BigInt(e)}),s=new a.Transaction({blockhash:r,lastValidBlockHeight:o}).add(i);return s.add(a.ComputeBudgetProgram.setComputeUnitPrice({microLamports:0})),s.feePayer=t,s}function E(t){if("version"in t)for(let e of t.message.compiledInstructions){let r=t.message.staticAccountKeys[e.programIdIndex];if(r&&a.ComputeBudgetProgram.programId.equals(r)&&2===e.data[0]){const t=new a.TransactionInstruction({keys:[],programId:a.ComputeBudgetProgram.programId,data:g.from(e.data)});return a.ComputeBudgetInstruction.decodeSetComputeUnitLimit(t).units}}else for(let e of t.instructions)if(a.ComputeBudgetProgram.programId.equals(e.programId)&&2===e.data[0])return a.ComputeBudgetInstruction.decodeSetComputeUnitLimit(e).units;return null}function b(t){if("version"in t)for(let e of t.message.compiledInstructions){let r=t.message.staticAccountKeys[e.programIdIndex];if(r&&a.ComputeBudgetProgram.programId.equals(r)&&3===e.data[0]){const t=new a.TransactionInstruction({keys:[],programId:a.ComputeBudgetProgram.programId,data:g.from(e.data)});return a.ComputeBudgetInstruction.decodeSetComputeUnitPrice(t).microLamports}}else for(let e of t.instructions)if(a.ComputeBudgetProgram.programId.equals(e.programId)&&3===e.data[0])return a.ComputeBudgetInstruction.decodeSetComputeUnitPrice(e).microLamports;return null}const S=(t,e)=>{if(!("version"in t)){for(let r of t.instructions)if(a.ComputeBudgetProgram.programId.equals(r.programId)&&2===r.data[0])return r.data=a.ComputeBudgetProgram.setComputeUnitLimit({units:e}).data,!0;return t.add(a.ComputeBudgetProgram.setComputeUnitLimit({units:e})),!0}for(let r of t.message.compiledInstructions){let o=t.message.staticAccountKeys[r.programIdIndex];if(o&&a.ComputeBudgetProgram.programId.equals(o)&&2===r.data[0])return r.data=Uint8Array.from(a.ComputeBudgetProgram.setComputeUnitLimit({units:e}).data),!0}return!1},k=(t,e)=>{if(!("version"in t)){for(let r of t.instructions)if(a.ComputeBudgetProgram.programId.equals(r.programId)&&3===r.data[0])return r.data=a.ComputeBudgetProgram.setComputeUnitPrice({microLamports:e}).data,!0;return t.add(a.ComputeBudgetProgram.setComputeUnitPrice({microLamports:e})),!0}for(let r of t.message.compiledInstructions){let o=t.message.staticAccountKeys[r.programIdIndex];if(o&&a.ComputeBudgetProgram.programId.equals(o)&&3===r.data[0])return r.data=Uint8Array.from(a.ComputeBudgetProgram.setComputeUnitPrice({microLamports:e}).data),!0}return!1},x=async(t,e)=>{let r=[];if(e.tx)if("version"in e.tx){const t=e.tx.message.staticAccountKeys;for(const[o,n]of t.entries())e.tx.message.isAccountWritable(o)&&r.push(n)}else for(const t of e.tx.instructions)for(const e of t.keys)e.isWritable&&r.push(e.pubkey);if(e.accounts&&(r=r.concat(e.accounts)),r.length){let e=await t.getRecentPrioritizationFees({lockedWritableAccounts:r});e=e.sort(((t,e)=>e.slot-t.slot)),e=e.slice(0,20);let o=e.map((t=>t.prioritizationFee)).sort(((t,e)=>e-t));return Math.max(o[Math.floor(85*o.length/100)],1)}return 1},M=t=>{if((()=>{try{return t.serialize({requireAllSignatures:!1}).length}catch(t){return a.PACKET_DATA_SIZE+1}})()>a.PACKET_DATA_SIZE)return{error:new p(f.TRANSACTION_TOO_LARGE)}},B=t=>{if(null==t||0==t.length)return;const e=o.AccountLayout.decode(t);return e.mint=new a.PublicKey(e.mint),e.owner=new a.PublicKey(e.owner),e.amount=o.u64.fromBuffer(e.amount),0===e.delegateOption?(e.delegate=null,e.delegatedAmount=new o.u64(0)):(e.delegate=new a.PublicKey(e.delegate),e.delegatedAmount=o.u64.fromBuffer(e.delegatedAmount)),e.isInitialized=0!==e.state,e.isFrozen=2===e.state,1===e.isNativeOption?(e.rentExemptReserve=o.u64.fromBuffer(e.isNative),e.isNative=!0):(e.rentExemptReserve=null,e.isNative=!1),0===e.closeAuthorityOption?e.closeAuthority=null:e.closeAuthority=new a.PublicKey(e.closeAuthority),e},K=(t,e)=>{if(t.length!==o.MintLayout.span)return;const r=o.MintLayout.decode(t);return r.address=e,0===r.mintAuthorityOption?r.mintAuthority=null:r.mintAuthority=new a.PublicKey(r.mintAuthority),r.supply=o.u64.fromBuffer(r.supply),r.isInitialized=0!==r.isInitialized,0===r.freezeAuthorityOption?r.freezeAuthority=null:r.freezeAuthority=new a.PublicKey(r.freezeAuthority),r};async function U(t,e){const r=await o.Token.getAssociatedTokenAddress(o.ASSOCIATED_TOKEN_PROGRAM_ID,o.TOKEN_PROGRAM_ID,o.NATIVE_MINT,e,!0);return{address:r,accountInfo:await t.getAccountInfo(r)}}async function F({connection:t,publicKey:e,blockhash:r,lastValidBlockHeight:n,amountToTransferInLamports:i}){const s=await U(t,e),c=[];s.accountInfo||c.push(o.Token.createAssociatedTokenAccountInstruction(o.ASSOCIATED_TOKEN_PROGRAM_ID,o.TOKEN_PROGRAM_ID,o.NATIVE_MINT,s.address,e,e)),c.push(a.SystemProgram.transfer({fromPubkey:e,toPubkey:s.address,lamports:i})),c.push(o.Token.createSyncNativeInstruction(o.TOKEN_PROGRAM_ID,s.address));const u=new a.Transaction({feePayer:e,blockhash:r,lastValidBlockHeight:n});return u.add(...c),u}async function v({connection:t,publicKey:e,blockhash:r,lastValidBlockHeight:n}){const i=await U(t,e),s=[];if(!i.accountInfo)return;s.push(o.Token.createCloseAccountInstruction(o.TOKEN_PROGRAM_ID,i.address,e,e,[]));const c=new a.Transaction({feePayer:e,blockhash:r,lastValidBlockHeight:n});return c.add(...s),c}const L=async(t,e,r)=>{let o;try{return o=await(0,u.Ob)(t,e,!0),{account:await r.getAccountInfo(o),toAccount:o}}catch(t){throw m.error("Error::getATA",t),t}},z=async(t,e,r,o=e)=>{try{const{account:n,toAccount:a}=await L(t,e,r);return n?[a,void 0]:[a,(0,d.CA)(o,a,e,t)]}catch(t){throw m.error("Error::getOrCreateATAInstruction",t),t}},D=new a.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),j=new a.PublicKey("META4s4fSmpkTbZoUsgC1oBnWB31vQcmnN8giPw51Zu");function q(t,e){const r=e.equals(o.TOKEN_PROGRAM_ID)?D:j;return a.PublicKey.findProgramAddressSync([g.from("metadata"),r.toBuffer(),t.toBuffer()],r)[0]}const W=new a.PublicKey("TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb");async function G(t,e){return(await c.Wp.rpc.getMultipleAccounts(t,e)).reduce(((t,r,n)=>{if(r){const{publicKey:a,account:i}=r;if(i.owner.equals(o.TOKEN_PROGRAM_ID)||i.owner.equals(W))try{const s=(0,u.tH)(a,i,i.owner);t.push([e[n].toString(),{mintAuthority:s.mintAuthority,supply:new o.u64(s.supply.toString()),decimals:s.decimals,isInitialized:s.isInitialized,freezeAuthority:s.freezeAuthority,programId:r.account.owner}])}catch(t){m.log("Failed to fetch or decode mint",e[n].toString(),t)}}return t}),new Array)}const V=t=>t.replace(/\u0000/g,"");async function H(t,e){const r=e.map((t=>q(t.mint,t.programId)));return(await c.Wp.rpc.getMultipleAccounts(t,r)).reduce(((t,e)=>{if(e){const r=l.Metadata.deserialize(e.account.data)[0];r.data.name=V(r.data.name),r.data.symbol=V(r.data.symbol),r.data.uri=V(r.data.uri),t.push({publicKey:e.publicKey,account:r})}return t}),new Array)}const Z=async(t,e,r)=>{const o=new Map;var n;return await Promise.all((n=e,Array.apply(0,new Array(Math.ceil(n.length/99))).map(((t,e)=>n.slice(99*e,99*(e+1))))).map((async e=>{(await t.getMultipleAccountsInfo(e,r)).forEach(((t,r)=>{o.set(e[r].toString(),t)}))}))),o}}}]);
//# sourceMappingURL=main-4.0.1-449.js.map